<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >  
<mapper namespace="com.app.dao.RISDao" >  
   
     <select id="searchOrder" resultType="java.util.Map" parameterType="java.util.Map">  
        select * from hisorder.his_order where applyCode=#{HISEXAMNO}       
        and validFlag=0
    </select> 
    
    <insert id="saveOrder"  parameterType="java.util.Map">  
        insert into hisorder.his_order
        (applyCode,patientCode,visitNO,patientId,cardNO,
        patientName,brithday,sex,phone,address,
        authorName,authorCode,checkMethod,checkMethodCode,
        applyOffice,checkPart,disease,history,note,bedNO,charge,        
        identityNO,organization,verifierTime,authorTime,executeOfficeCode, executeOffice,
        yibao,orderCode,createDate, createTime)
        values(
        	#{HISEXAMNO},#{PATIENTTYPE},#{VISITTIMES},#{DIAGNOSEID},#{HISID},
        	#{NAME},#{BIRTHDATE},#{SEX},#{TELEPHONE},#{ADDRESS},
        	#{LODGEDOCTOR},#{LODGEDOCTORCODE},#{CHECKITEM},#{CHECKITEMID},
        	#{LODGESECTION},#{CHECKPART},#{CLINICALDIAGNOSIS},#{CLINICALSIGN},
        	#{CHECKAIM},#{BEDNO},#{MONEY},
        	#{IDENTITYCARD},#{WORKUNIT},#{PAYMONEYDATE},#{APPLYTIME},#{EXECUTESECTIONNO},#{EXECUTESECTION},
        	#{HEALTHTYPE},#{CHECKSERIALNUM}, current_date,current_time
        )

    </insert> 
    
     <update id="updateOrder"  parameterType="java.util.Map">  
        update hisorder.his_order set 
        applyCode=#{HISEXAMNO},patientCode=#{PATIENTTYPE},visitNO=#{VISITTIMES},patientId=#{DIAGNOSEID},cardNO=#{HISID},
        patientName=#{NAME},brithday=#{BIRTHDATE},sex=#{SEX},phone=#{TELEPHONE},address=#{ADDRESS},
        authorName=#{LODGEDOCTOR},authorCode=#{LODGEDOCTORCODE},checkMethod=#{CHECKITEM},checkMethodCode=#{CHECKITEMID},
        applyOffice=#{LODGESECTION},checkPart=#{CHECKPART},disease=#{CLINICALDIAGNOSIS},history=#{CLINICALSIGN},
        note=#{CHECKAIM},bedNO=#{BEDNO},charge=#{MONEY},         
        identityNO=#{IDENTITYCARD},organization=#{WORKUNIT},verifierTime=#{PAYMONEYDATE},authorTime=#{APPLYTIME},
        executeOfficeCode=#{EXECUTESECTIONNO}, executeOffice=#{EXECUTESECTION},
        yibao=#{HEALTHTYPE},orderCode=#{CHECKSERIALNUM} 
        where  applyCode=#{HISEXAMNO}         
        and validFlag=0

    </update> 
    
     <update id="invalidOrder"  parameterType="java.util.Map">  
        update hisorder.his_order set validFlag=1 
        where  applyCode=#{HISEXAMNO}         
        and validFlag=0
    </update> 
    
    <select id="searchProcedure" resultType="java.util.Map" parameterType="java.util.Map">  
	    SELECT m.ModalityID,psi.ProcedureStepID,psi.ProcedureStepName,ps.ProcedureName,m.ModalityName,md.deptname,m.ModalityLocation 
		FROM gecris.ProcedureStepInfo psi,gecris.ProcedureInfo ps,gecris.ModalityInfo
		m,gecris.modalitydept md WHERE psi.ProcedureID=ps.ProcedureID AND m.is_valid=true AND
		ps.ProcedureIDType=m.ModalityID AND m.deptid=md.deptid AND
		psi.Status='active' AND psi.procedurestep_code=#{CHECKITEMID} AND m.ModalityID=#{SCHEDULED_MODALITY} limit 1
    </select> 
</mapper>  